#/bin/sh

echo "\n===== Automated Renew Certificates ====="

while IFS='|' read -r domain email
do
    echo -e "\n- Trying to renew domain $domain of $email"
    sudo /opt/lego/lego -a -k rsa2048 --path /var/lego --email $email --domains $domain --http --http.webroot=/usr/share/nginx/acme-challenge renew --days 30 --renew-hook="/usr/bin/sudo /usr/bin/systemctl reload nginx.service"
done < /var/lego/renew_domains.txt

echo "\n===== DONE ====="